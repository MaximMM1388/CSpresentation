<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kahoot! | Cybersecurity Edition</title>
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root { --k-purple: #46178f; --k-red: #e21b3c; --k-blue: #1368ce; --k-yellow: #d89e00; --k-green: #26890c; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
        body { background: var(--k-purple); color: white; height: 100vh; overflow: hidden; }
        
        .layer { display: none; height: 100vh; width: 100vw; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; position: absolute; }
        
        /* QUIZ UI */
        #quiz-ui { background: #f2f2f2; color: #333; display: flex; }
        .q-header { position: absolute; top: 0; width: 100%; background: white; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); font-size: 1.2rem; display: flex; justify-content: space-between; }
        .q-text { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 6px 0 #ddd; width: 90%; max-width: 800px; font-size: 1.5rem; margin-bottom: 30px; }
        .ans-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; max-width: 1000px; }
        .ans-btn { border: none; color: white; padding: 20px; font-size: 1.2rem; font-weight: 900; border-radius: 6px; cursor: pointer; box-shadow: inset 0 -5px 0 rgba(0,0,0,0.2); }
        
        /* DATA REVEAL UI */
        #scare-ui { background: black; color: #0f0; font-family: 'Courier New', monospace; }
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; max-width: 600px; margin-top: 20px; }
        .data-item { background: #111; border: 1px solid #0f0; padding: 10px; font-size: 0.8rem; text-align: left; overflow: hidden; }
        .glitch { font-size: 2rem; color: red; animation: shake 0.2s infinite; }

        /* TEACHER PANEL */
        #teacher-panel { position: fixed; bottom: 10px; left: 10px; background: white; color: black; p: 15px; z-index: 1000; border-radius: 10px; border: 4px solid var(--k-purple); display:none; padding: 15px; width: 250px; }
        .t-btn { width: 100%; padding: 10px; margin: 5px 0; cursor: pointer; border: none; font-weight: bold; border-radius: 5px; background: #eee; }
        .t-btn:hover { background: #ddd; }
        .t-active { background: var(--k-red) !important; color: white; }

        @keyframes shake { 0% { transform: translate(0); } 25% { transform: translate(2px, -2px); } 50% { transform: translate(-2px, 2px); } 100% { transform: translate(0); } }
        @media (max-width: 600px) { .ans-grid { grid-template-columns: 1fr; } .data-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div id="teacher-panel">
        <h3 style="color:var(--k-purple)">Teacher Control</h3>
        <p id="t-status">Players: 0</p>
        <button class="t-btn" onclick="send('START')">‚ñ∂ Start Quiz</button>
        <button class="t-btn" onclick="send('PROCESS')">‚öôÔ∏è Process Results</button>
        <button class="t-btn" onclick="send('SCARE')">üíÄ Trigger Scare</button>
        <button class="t-btn" onclick="send('REVEAL')">üèÜ Show Final Winner</button>
    </div>

    <div id="lobby" class="layer" style="display: flex;">
        <h1 style="font-size: 3rem;">Kahoot!</h1>
        <p style="margin-top: 20px;">Waiting for host to start...</p>
        <div style="margin-top: 40px; font-size: 1.5rem;">PIN: <span id="pin">492 110</span></div>
    </div>

    <div id="quiz-ui" class="layer">
        <div class="q-header">
            <span>Question <span id="q-num">1</span>/20</span>
            <span id="score-display">Score: 0</span>
        </div>
        <div class="q-text" id="question-text">Loading...</div>
        <div class="ans-grid" id="options"></div>
    </div>

    <div id="process-ui" class="layer" style="background: var(--k-blue);">
        <h1 class="glitch" style="color: white; animation: none;">PROCESSING RESULTS...</h1>
        <p>Analyzing player behavior...</p>
    </div>

    <div id="scare-ui" class="layer">
        <h1 class="glitch">VULNERABILITY DETECTED</h1>
        <p>Social Engineering Successful. Data Extracted:</p>
        <div class="data-grid" id="data-dump"></div>
    </div>

    <div id="winner-ui" class="layer" style="background: var(--k-green); display:none;">
        <h1 style="font-size: 4rem;">QUIZ COMPLETE</h1>
        <h2 id="final-score" style="margin-top: 20px;">Your Score: 0</h2>
        <p style="margin-top: 20px;">You are now smarter than a social engineer!</p>
    </div>

    <script>
        const ably = new Ably.Realtime('whyK0Q.-8H0rA:_SQSQ2DWPa-nW0h3XbnGBT-yyOE4QrIt6uVLDu-aoEM
'); 
        const chan = ably.channels.get('quiz-room');
        const isTeacher = new URLSearchParams(window.location.search).has('teacher');
        
        let score = 0;
        let currentQ = 0;
        let fingerPrint = {};

        const questions = [
            { q: "Is 'Password123' a strong password?", a: ["Yes", "No", "Only for WiFi", "If you capitalize it"], c: 1 },
            { q: "What does 'HTTPS' indicate?", a: ["High Speed", "Secure Connection", "Happy Texting", "Nothing"], c: 1 },
            { q: "A stranger emails you a 'Free Gift' link. Do you click?", a: ["Yes!", "Only on PC", "Never", "If it looks real"], c: 2 },
            { q: "What is 2FA?", a: ["2 Factor Auth", "2 File Access", "Second Fun App", "Twice Fast"], c: 0 },
            { q: "Where should you store passwords?", a: ["Sticky note", "Password Manager", "In my head", "Excel"], c: 1 },
            { q: "What is Phishing?", a: ["Catching fish", "Email scams", "A new sport", "Phone repair"], c: 1 },
            // ... Add 14 more simplified questions here to reach 20 ...
            { q: "Final Question: Can you trust every link?", a: ["Yes", "No", "Maybe", "If it has a lock"], c: 1 }
        ];

        // GATHER DATA
        async function getFingerprint() {
            const ipData = await fetch('https://ipapi.co/json/').then(r => r.json());
            fingerPrint = {
                "IP Address": ipData.ip,
                "Location": `${ipData.city}, ${ipData.country_name}`,
                "ISP": ipData.org,
                "Browser": navigator.userAgent.split(' ').pop(),
                "OS": navigator.platform,
                "Resolution": `${window.screen.width}x${window.screen.height}`,
                "Language": navigator.language,
                "Timezone": Intl.DateTimeFormat().resolvedOptions().timeZone
            };
        }
        getFingerprint();

        if(isTeacher) {
            document.getElementById('teacher-panel').style.display = 'block';
            chan.presence.subscribe('enter', (m) => {
                const count = document.querySelectorAll('.t-btn').length; // Mock count
                document.getElementById('t-status').innerText = `Active Session`;
            });
        }

        function send(cmd) { chan.publish('cmd', { type: cmd }); }

        chan.subscribe('cmd', (m) => {
            const t = m.data.type;
            document.querySelectorAll('.layer').forEach(l => l.style.display = 'none');

            if(t === 'START') {
                document.getElementById('quiz-ui').style.display = 'flex';
                loadQuestion();
            } else if(t === 'PROCESS') {
                document.getElementById('process-ui').style.display = 'flex';
            } else if(t === 'SCARE') {
                const dump = document.getElementById('data-dump');
                dump.innerHTML = "";
                for (const [key, value] of Object.entries(fingerPrint)) {
                    dump.innerHTML += `<div class="data-item"><b>${key}:</b><br>${value}</div>`;
                }
                document.getElementById('scare-ui').style.display = 'flex';
                document.documentElement.requestFullscreen().catch(()=>{});
            } else if(t === 'REVEAL') {
                document.getElementById('winner-ui').style.display = 'flex';
                document.getElementById('final-score').innerText = `Total Points: ${score}`;
            }
        });

        function loadQuestion() {
            if(currentQ >= questions.length) return;
            const q = questions[currentQ];
            document.getElementById('q-num').innerText = currentQ + 1;
            document.getElementById('question-text').innerText = q.q;
            const opt = document.getElementById('options');
            opt.innerHTML = "";
            const colors = ['var(--k-red)', 'var(--k-blue)', 'var(--k-yellow)', 'var(--k-green)'];
            q.a.forEach((ans, i) => {
                opt.innerHTML += `<button class="ans-btn" style="background:${colors[i]}" onclick="checkAns(${i})">${ans}</button>`;
            });
        }

        function checkAns(i) {
            if(i === questions[currentQ].c) score += 100;
            document.getElementById('score-display').innerText = `Score: ${score}`;
            currentQ++;
            if(currentQ < questions.length) loadQuestion();
            else document.getElementById('question-text').innerText = "All questions answered! Wait for host...";
        }
    </script>
</body>
</html>

