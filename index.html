<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cybsec Quiz | Maxim Mlynek</title>
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root { --p: #46178f; --r: #e21b3c; --b: #1368ce; --y: #d89e00; --g: #26890c; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
        body { background: var(--p); color: white; height: 100vh; overflow: hidden; }
        .view { display: none; height: 100%; width: 100%; flex-direction: column; align-items: center; justify-content: center; position: absolute; padding: 20px; text-align: center; }
        
        input { padding: 15px; border-radius: 5px; border: none; font-size: 1.2rem; margin: 10px; width: 80%; max-width: 300px; text-align: center; }
        .btn { padding: 15px 30px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 1.1rem; color: white; box-shadow: inset 0 -4px rgba(0,0,0,0.2); }
        
        #view-quiz { background: #f2f2f2; color: #333; }
        .q-card { background: white; padding: 25px; border-radius: 10px; margin-bottom: 20px; width: 100%; max-width: 600px; font-size: 1.4rem; font-weight: 700; box-shadow: 0 6px #ddd; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; max-width: 600px; }
        
        /* Podium & Leaderboard */
        .leaderboard-list { list-style: none; width: 100%; max-width: 400px; text-align: left; background: rgba(0,0,0,0.2); padding: 20px; border-radius: 10px; }
        .leaderboard-list li { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; }
        
        #teacher-ui { position: fixed; inset: 0; background: white; color: black; z-index: 9999; display: none; flex-direction: column; align-items: center; overflow-y: auto; padding: 20px; }
        .t-btn { width: 280px; padding: 12px; margin: 5px; border: 2px solid #333; font-weight: bold; cursor: pointer; border-radius: 5px; }
        
        .data-box { background: #111; color: #0f0; border: 1px solid #0f0; padding: 10px; margin: 5px; width: 90%; max-width: 450px; display: none; font-family: monospace; text-align: left; }
    </style>
</head>
<body>

    <div id="teacher-ui">
        <h2 style="color:var(--p)">Maxim's Admin Panel</h2>
        <div style="margin: 10px 0;">
            <button class="t-btn" style="background:var(--p); color:white" onclick="send('START1')">‚ñ∂ START PART 1 (Basics)</button>
            <button class="t-btn" onclick="send('LOBBY')">‚è∏ PAUSE / LOBBY</button>
            <button class="t-btn" style="background:var(--p); color:white" onclick="send('START2')">‚ñ∂ START PART 2 (Social Eng)</button>
        </div>
        <hr style="width:100%; margin:10px">
        <div style="display:flex; gap:10px">
            <button class="t-btn" style="width:135px; background:var(--b); color:white" onclick="send('LEAD1')">MID LEADERBOARD</button>
            <button class="t-btn" style="width:135px; background:var(--g); color:white" onclick="send('PODIUM')">üèÜ FINAL PODIUM</button>
        </div>
        <hr style="width:100%; margin:10px">
        <button class="t-btn" style="background:var(--r); color:white" onclick="send('S1')">REVEAL IP</button>
        <button class="t-btn" style="background:var(--r); color:white" onclick="send('S2')">REVEAL LOCATION</button>
        <button class="t-btn" style="background:var(--r); color:white" onclick="send('S3')">REVEAL ISP</button>
        <button class="t-btn" style="background:var(--r); color:white" onclick="send('S4')">REVEAL SYSTEM</button>
        <hr style="width:100%; margin:10px">
        <button class="t-btn" onclick="send('END')">THANKS & RATE</button>

        <h3 style="margin-top:20px">Live Player Scores:</h3>
        <ul id="t-scores" style="text-align:left; width: 280px;"></ul>
    </div>

    <div id="view-entry" class="view" style="display:flex">
        <h1>Kahoot!</h1>
        <input type="text" id="nick" placeholder="Nickname">
        <button class="btn" style="background:var(--g)" onclick="join()">JOIN</button>
    </div>

    <div id="view-lobby" class="view">
        <h1>Welcome, <span id="p-name"></span>!</h1>
        <p>Waiting for Maxim to continue...</p>
    </div>

    <div id="view-quiz" class="view">
        <div id="q-txt" class="q-card"></div>
        <div id="ans" class="grid"></div>
        <div style="margin-top:20px; font-weight:900">Score: <span id="score">0</span></div>
    </div>

    <div id="view-leaderboard" class="view" style="background:var(--b)">
        <h1>LEADERBOARD</h1>
        <ul id="l-list" class="leaderboard-list"></ul>
    </div>

    <div id="view-scare" class="view" style="background:black; color:red">
        <h1>‚ö†Ô∏è SYSTEM COMPROMISED ‚ö†Ô∏è</h1>
        <div id="d1" class="data-box"></div>
        <div id="d2" class="data-box"></div>
        <div id="d3" class="data-box"></div>
        <div id="d4" class="data-box"></div>
    </div>

    <div id="view-end" class="view" style="background:var(--g)">
        <h1>Thanks for your attention!</h1>
        <div style="margin-top:20px">
            <p>Rate Maxim's presentation:</p>
            <div id="rating">
                <script>for(let i=1;i<=10;i++) document.write(`<button class="btn" style="padding:10px; margin:2px; width:40px" onclick="this.parentElement.innerHTML='<h1>ü§©</h1>'">${i}</button>`)</script>
            </div>
        </div>
    </div>

    <script>
        const ably = new Ably.Realtime('PASTE_YOUR_KEY_HERE'); 
        const chan = ably.channels.get('quiz-v3');
        const isTeacher = new URLSearchParams(window.location.search).has('teacher');
        
        let pts = 0, name = "", info = {}, players = {};

        const group1 = [
            { q: "What is the first stage of Pen Testing?", a: ["Scanning", "Recon", "Access", "Cleanup"], c: 1 },
            { q: "What does 'Recon' stand for?", a: ["Recognition", "Reconnaissance", "Record", "Recovery"], c: 1 },
            { q: "Which stage involves active interaction (like port scanning)?", a: ["Recon", "Scanning", "Access", "Maintenance"], c: 1 },
            { q: "True or False: Pen testing is illegal if you have permission.", a: ["True", "False"], c: 1 },
            { q: "Why do hackers want to 'Maintain Access'?", a: ["To get faster WiFi", "To keep control of the system", "To delete files", "To help the user"], c: 1 },
            { q: "Who usually hires Pen Testers?", a: ["Criminals", "Companies/Governments", "Script Kiddies", "Nobody"], c: 1 },
            { q: "What color 'hat' does an ethical hacker wear?", a: ["Black", "Gray", "White", "Red"], c: 2 },
            { q: "Who follows a 'Code of Ethics'?", a: ["Black Hat", "White Hat", "Gray Hat", "Everyone"], c: 1 },
            { q: "What does 2FA stand for?", a: ["2 Factor Auth", "2 File Access", "Fast Apps", "None"], c: 0 },
            { q: "Is Pen Testing a one-time thing or a regular process?", a: ["One-time", "Regular Process"], c: 1 },
            { q: "Can a Gray Hat be sued?", a: ["No", "Yes", "Only if they win", "Maybe"], c: 1 }
        ];

        const group2 = [
            { q: "What is 'Phishing'?", a: ["Fake emails", "Fishing", "Passwords", "Hardware"], c: 0 },
            { q: "What is 'Baiting'?", a: ["Scaring users", "Luring with a reward", "Coding", "WiFi hacking"], c: 1 },
            { q: "True or False: Tech can stop 100% of social engineering.", a: ["True", "False"], c: 1 },
            { q: "What is 'Dumpster Diving'?", a: ["Searching trash for info", "Swimming", "Deleting files", "Broken PC"], c: 0 },
            { q: "How does an attacker gain 'Trust'?", a: ["Using a virus", "Perceived leadership/Authority", "Stealing", "Fast typing"], c: 1 },
            { q: "Is a 'fake IT expert' a social engineering tactic?", a: ["Yes", "No"], c: 0 },
            { q: "What does 2FA stand for?", a: ["2 Factor Auth", "2 File Access", "Fast Apps", "None"], c: 0 },
            { q: "What is a 'DDoS' attack?", a: ["Deleting Data", "Overwhelming a server", "Direct Drive", "None"], c: 1 },
            { q: "Who is the most important person in cybersecurity?", a: ["Bill Gates", "Hackers", "The User (You)", "IT Guys"], c: 2 },
            { q: "What is a 'VPN'?", a: ["Virtual Private Network", "Very Public Network", "Virus", "None"], c: 0 }
        ];

        

        if(isTeacher) {
            document.getElementById('teacher-ui').style.display = 'flex';
        } else {
            fetch('https://ipapi.co/json/').then(r=>r.json()).then(d => {
                info = { s1: "IP: "+d.ip, s2: "LOC: "+d.city+", "+d.country_name, s3: "ISP: "+d.org, s4: "SYS: "+navigator.platform };
            });
        }

        function join() {
            name = document.getElementById('nick').value;
            if(!name) return;
            document.getElementById('p-name').innerText = name;
            chan.publish('join', {name: name});
            show('view-lobby');
        }

        function send(cmd) { chan.publish('m', cmd); }

        chan.subscribe('join', m => { if(isTeacher) players[m.data.name] = 0; });
        chan.subscribe('score', m => { 
            players[m.data.name] = m.data.score;
            if(isTeacher) updateTeacherList();
        });

        chan.subscribe('m', m => {
            const t = m.data;
            if(t === 'START1') { show('view-quiz'); loadQ(group1); }
            else if(t === 'START2') { show('view-quiz'); loadQ(group2); }
            else if(t === 'LOBBY') show('view-lobby');
            else if(t === 'LEAD1' || t === 'PODIUM') {
                show('view-leaderboard');
                renderLeaderboard();
            }
            else if(t === 'END') show('view-end');
            else if(t.startsWith('S')) {
                show('view-scare');
                const id = "d" + t.charAt(1);
                const el = document.getElementById(id);
                el.style.display = 'block';
                el.innerText = info[t.toLowerCase()];
                document.documentElement.requestFullscreen().catch(()=>{});
            }
        });

        function loadQ(arr) {
            let idx = 0;
            const next = () => {
                const q = arr[idx];
                document.getElementById('q-txt').innerText = q.q;
                const area = document.getElementById('ans');
                area.innerHTML = '';
                q.a.forEach((txt, i) => {
                    const b = document.createElement('button');
                    b.className = 'btn'; b.style.background = ['var(--r)','var(--b)','var(--y)','var(--g)'][i%4];
                    b.innerText = txt;
                    b.onclick = () => {
                        if(i === q.c) pts += 100;
                        document.getElementById('score').innerText = pts;
                        chan.publish('score', {name: name, score: pts});
                        idx++;
                        if(idx < arr.length) next();
                        else document.getElementById('q-txt').innerText = "Wait for Maxim...";
                    };
                    area.appendChild(b);
                });
            };
            next();
        }

        function renderLeaderboard() {
            const list = document.getElementById('l-list');
            list.innerHTML = '';
            Object.entries(players).sort((a,b)=>b[1]-a[1]).forEach(([n, s]) => {
                list.innerHTML += `<li><span>${n}</span><span>${s} pts</span></li>`;
            });
        }

        function updateTeacherList() {
            const list = document.getElementById('t-scores');
            list.innerHTML = '';
            Object.entries(players).sort((a,b)=>b[1]-a[1]).forEach(([n, s]) => {
                list.innerHTML += `<li>${n}: ${s}</li>`;
            });
        }

        function show(id) {
            document.querySelectorAll('.view').forEach(v => v.style.display = 'none');
            document.getElementById(id).style.display = 'flex';
        }
    </script>
</body>
</html>
