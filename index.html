<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cybsec Quiz</title>
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root { --p: #46178f; --r: #e21b3c; --b: #1368ce; --y: #d89e00; --g: #26890c; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
        body { background: var(--p); color: white; height: 100vh; overflow: hidden; }
        .view { display: none; height: 100%; width: 100%; flex-direction: column; align-items: center; justify-content: center; position: absolute; padding: 20px; text-align: center; }
        
        /* Buttons & Inputs */
        input { padding: 15px; border-radius: 5px; border: none; font-size: 1.2rem; margin: 10px; width: 80%; max-width: 300px; }
        .btn { padding: 15px 30px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 1.1rem; color: white; box-shadow: inset 0 -4px rgba(0,0,0,0.2); }
        
        /* Quiz Styles */
        #view-quiz { background: #f2f2f2; color: #333; }
        .q-card { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; width: 100%; max-width: 600px; font-size: 1.3rem; box-shadow: 0 4px #ccc; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; max-width: 600px; }
        
        /* Scare Styles */
        .data-box { background: #111; color: #0f0; border: 1px solid #0f0; padding: 10px; margin: 5px; width: 90%; max-width: 450px; display: none; font-family: monospace; text-align: left; font-size: 0.9rem; }

        /* Teacher Panel */
        #teacher-ui { position: fixed; inset: 0; background: white; color: black; z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .t-btn { width: 250px; padding: 12px; margin: 5px; border: 2px solid #333; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div id="teacher-ui">
        <h2 style="color:var(--p)">Quiz Controller</h2>
        <button class="t-btn" onclick="send('START')">START QUIZ</button>
        <button class="t-btn" onclick="send('PROCESS')">PAUSE / PROCESSING</button>
        <hr style="width:200px; margin:10px">
        <button class="t-btn" style="background:var(--r); color:white" onclick="send('S1')">REVEAL IP</button>
        <button class="t-btn" style="background:var(--r); color:white" onclick="send('S2')">REVEAL LOCATION</button>
        <button class="t-btn" style="background:var(--r); color:white" onclick="send('S3')">REVEAL DEVICE</button>
        <button class="t-btn" style="background:var(--r); color:white" onclick="send('S4')">REVEAL SYSTEM</button>
        <hr style="width:200px; margin:10px">
        <button class="t-btn" onclick="send('END')">SHOW FINAL SCORE</button>
    </div>

    <div id="view-entry" class="view" style="display:flex">
        <h1>Kahoot!</h1>
        <input type="text" id="nick" placeholder="Enter Nickname">
        <button class="btn" style="background:var(--g)" onclick="join()">JOIN</button>
    </div>

    <div id="view-lobby" class="view">
        <h1>Welcome, <span id="p-name"></span>!</h1>
        <p>Wait for the teacher to start...</p>
    </div>

    <div id="view-quiz" class="view">
        <div style="margin-bottom:10px">Question <span id="q-num">1</span>/20</div>
        <div class="q-card" id="q-txt"></div>
        <div class="grid" id="ans"></div>
        <div style="margin-top:20px">Score: <span id="score">0</span></div>
    </div>

    <div id="view-process" class="view" style="background:var(--b)">
        <h1>ANALYZING DATA...</h1>
        <p>Please wait for results.</p>
    </div>

    <div id="view-scare" class="view" style="background:black; color:red">
        <h1 style="margin-bottom:20px">VULNERABILITY FOUND</h1>
        <div id="d1" class="data-box"></div>
        <div id="d2" class="data-box"></div>
        <div id="d3" class="data-box"></div>
        <div id="d4" class="data-box"></div>
    </div>

    <div id="view-end" class="view" style="background:var(--g)">
        <h1>FINISHED</h1>
        <h2 id="final"></h2>
    </div>

    <script>
        // REPLACE WITH YOUR KEY
        const ably = new Ably.Realtime('whyK0Q.-8H0rA:_SQSQ2DWPa-nW0h3XbnGBT-yyOE4QrIt6uVLDu-aoEM'); 
        const chan = ably.channels.get('quiz');
        const isTeacher = new URLSearchParams(window.location.search).has('teacher');
        
        let pts = 0, qIdx = 0, name = "", info = {};

        const questions = [
            { q: "What is Cybersecurity?", a: ["Protecting systems", "Coding", "Gaming", "WiFi"], c: 0 },
            { q: "A Pen Test is a...", a: ["Repair", "Security Exercise", "Game", "Law"], c: 1 },
            { q: "Stage 1 of Pen Testing?", a: ["Scanning", "Recon", "Access", "Maintenance"], c: 1 },
            { q: "Stage 2 of Pen Testing?", a: ["Recon", "Scanning", "Access", "Maintenance"], c: 1 },
            { q: "Stage 3 of Pen Testing?", a: ["Scanning", "Access", "Maintenance", "Recon"], c: 1 },
            { q: "Stage 4 of Pen Testing?", a: ["Recon", "Scanning", "Maintenance", "Access"], c: 2 },
            { q: "Ethical hackers are...", a: ["Black Hat", "Gray Hat", "White Hat", "No Hat"], c: 2 },
            { q: "Unethical hackers are...", a: ["White Hat", "Black Hat", "Blue Hat", "Green Hat"], c: 1 },
            { q: "The 'Weakest Link' is...", a: ["Hardware", "Software", "People", "Internet"], c: 2 },
            { q: "Recon stands for...", a: ["Recording", "Reconnaissance", "Recovery", "Reading"], c: 1 },
            { q: "Scanning is done...", a: ["First", "After Recon", "At the end", "Never"], c: 1 },
            { q: "Social Engineering uses...", a: ["Only code", "Psychology", "Brute force", "Nothing"], c: 1 },
            { q: "Phishing involves...", a: ["Fake emails", "Fishing", "Passwords", "Hardware"], c: 0 },
            { q: "Where to save passwords?", a: ["Sticky note", "Password Manager", "Text file", "Desktop"], c: 1 },
            { q: "What is 2FA?", a: ["2 Factor Auth", "2 File Access", "Fast Apps", "None"], c: 0 },
            { q: "Is 'Password123' safe?", a: ["Yes", "No", "Maybe", "Sometimes"], c: 1 },
            { q: "White hats find...", a: ["Money", "Vulnerabilities", "Games", "Pictures"], c: 1 },
            { q: "Black hats...", a: ["Protect", "Fix", "Steal/Destroy", "Teach"], c: 2 },
            { q: "Gray hats are...", a: ["Ethical", "Unethical", "In between", "Bots"], c: 2 },
            { q: "Cybersecurity protects...", a: ["Networks", "Data", "Devices", "All of these"], c: 3 }
        ];

        if(isTeacher) {
            document.getElementById('teacher-ui').style.display = 'flex';
        } else {
            fetch('https://ipapi.co/json/').then(r=>r.json()).then(d => {
                info = { s1: "IP: "+d.ip, s2: "LOC: "+d.city+", "+d.country_name, s3: "ISP: "+d.org, s4: "SYS: "+navigator.platform+" | "+navigator.language };
            });
        }

        function join() {
            name = document.getElementById('nick').value;
            if(!name) return;
            document.getElementById('p-name').innerText = name;
            show('view-lobby');
        }

        function send(cmd) { chan.publish('m', cmd); }

        chan.subscribe('m', (m) => {
            const t = m.data;
            if(t === 'START') { show('view-quiz'); load(); }
            else if(t === 'PROCESS') show('view-process');
            else if(t === 'END') { show('view-end'); document.getElementById('final').innerText = name+": "+pts+" pts"; }
            else if(t.startsWith('S')) {
                show('view-scare');
                const id = "d" + t.charAt(1);
                const el = document.getElementById(id);
                el.style.display = 'block';
                el.innerText = info[t.toLowerCase()];
                document.documentElement.requestFullscreen().catch(()=>{});
            }
        });

        function load() {
            const q = questions[qIdx];
            document.getElementById('q-num').innerText = qIdx + 1;
            document.getElementById('q-txt').innerText = q.q;
            const area = document.getElementById('ans');
            area.innerHTML = '';
            const clrs = ['var(--r)','var(--b)','var(--y)','var(--g)'];
            q.a.forEach((txt, i) => {
                const b = document.createElement('button');
                b.className = 'btn'; b.style.background = clrs[i]; b.innerText = txt;
                b.onclick = () => {
                    if(i === q.c) pts += 100;
                    document.getElementById('score').innerText = pts;
                    qIdx++;
                    if(qIdx < questions.length) load();
                    else document.getElementById('q-txt').innerText = "Waiting for Host...";
                };
                area.appendChild(b);
            });
        }

        function show(id) {
            document.querySelectorAll('.view').forEach(v => v.style.display = 'none');
            document.getElementById(id).style.display = 'flex';
        }
    </script>
</body>
</html>
